
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Communication, Interfaces &#8212; flownexus  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=64d943e2" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'architecture/communication_interfaces';</script>
    <link rel="icon" href="../_static/flownexus_favicon.svg"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Over the Air Updates" href="ota.html" />
    <link rel="prev" title="Leshan" href="leshan.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/flownexus_logo_dark.svg" class="logo__image only-light" alt="flownexus  documentation - Home"/>
    <script>document.write(`<img src="../_static/flownexus_logo_light.svg" class="logo__image only-dark" alt="flownexus  documentation - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Architecture</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="django.html">Django</a></li>
<li class="toctree-l2"><a class="reference internal" href="leshan.html">Leshan</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Communication, Interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="ota.html">Over the Air Updates</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../application_guide/index.html">Application Guide</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../application_guide/endpoint_interactions.html">Endpoint Interactions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../application_guide/events.html">Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="../application_guide/queue_mode.html">Queue Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../application_guide/fw_setup.html">Firmware Setup</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../deploy.html">Build and Deploy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../simulation.html">Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../documentation.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">APIs</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../api_doc/api.html">Internal Django</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">News and Updates</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../news/weblog.html">Weblog</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/jonas-rem/flownexus" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/jonas-rem/flownexus/edit/main/doc/source/architecture/communication_interfaces.rst" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/jonas-rem/flownexus/issues/new?title=Issue%20on%20page%20%2Farchitecture/communication_interfaces.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Communication, Interfaces</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-flow-endpoint-backend">Data Flow: Endpoint -&gt; Backend</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#leshan-data-format">Leshan Data Format</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#registration-updates">Registration Updates</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-flow-backend-endpoint">Data Flow: Backend -&gt; Endpoint</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#asynchronous-communication">Asynchronous Communication</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-communication">Example Communication</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="communication-interfaces">
<h1>Communication, Interfaces<a class="headerlink" href="#communication-interfaces" title="Link to this heading">#</a></h1>
<p>The communication between IoT devices and Leshan is specified by the OMA LwM2M
standard:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.openmobilealliance.org/release/LightweightM2M/V1_1_1-20190617-A/OMA-TS-LightweightM2M_Core-V1_1_1-20190617-A.pdf">LwM2M core specification v1.1.1</a></p></li>
<li><p><a class="reference external" href="https://www.openmobilealliance.org/release/LightweightM2M/V1_1_1-20190617-A/OMA-TS-LightweightM2M_Transport-V1_1_1-20190617-A.pdf">LwM2M transport binding v1.1.1</a></p></li>
</ul>
<p>The standard describes how the LwM2M server (Leshan) works, however, it does
not describe how to connect a backend server to Leshan. The backend is
responsible for storing the data in a database and implementing application
logic. A frontend can access the data in the database and visualize outward
facing user interfaces. Leshan acts as a gateway between Endpoints and the
backend. There should be no application specific logic implemented in Leshan.</p>
<p>In order to communicate and exchange data, both components (Leshan LwM2M Server
and Django) post data to each other’s ReST APIs. Communication is typically
triggered by IoT devices sending data or the user/application requesting data
from devices.</p>
<section id="data-flow-endpoint-backend">
<h2>Data Flow: Endpoint -&gt; Backend<a class="headerlink" href="#data-flow-endpoint-backend" title="Link to this heading">#</a></h2>
<p>All communication from Endpoints to the server flows through Leshan. Leshan
interprets this data according to the LwM2M protocol and generates a ReST API
call to the backend server. The backend server then stores the data in the
database.</p>
<p>Django hosts the ReST API that Leshan posts to. Serializers, a part of Django,
deserialize the incoming data and store it in the database according to the
database model.</p>
<section id="leshan-data-format">
<h3>Leshan Data Format<a class="headerlink" href="#leshan-data-format" title="Link to this heading">#</a></h3>
<p>There are two types of data that Leshan sends to the backend, single resource
and composite resource format. The two ReST API endpoints that Leshan posts to
are available under the following URLs:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/leshan_api/resource/single</span></code>: single resource format.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/leshan_api/resource/composite</span></code>: composite resource format.</p></li>
</ul>
<p>For more details, please theck the <code class="docutils literal notranslate"><span class="pre">Internal</span> <span class="pre">Django</span></code> API documentation.</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">Single Resource Format (3303/0/5700)</span><a class="headerlink" href="#id1" title="Link to this code">#</a></div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">   </span><span class="nt">&quot;ep&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;qemu_x86&quot;</span><span class="p">,</span>
<span class="w">   </span><span class="nt">&quot;obj_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3303</span><span class="p">,</span>
<span class="w">   </span><span class="nt">&quot;val&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">       </span><span class="nt">&quot;kind&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;singleResource&quot;</span><span class="p">,</span>
<span class="w">       </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5700</span><span class="p">,</span>
<span class="w">       </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;FLOAT&quot;</span><span class="p">,</span>
<span class="w">       </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;24.899181214836236&quot;</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Composite Resource Format (3/0/0..17)</span><a class="headerlink" href="#id2" title="Link to this code">#</a></div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;ep&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;qemu_x86&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;val&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;instances&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;kind&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;instance&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;resources&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;kind&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;singleResource&quot;</span><span class="p">,</span>
<span class="hll"><span class="w">                </span><span class="nt">&quot;id&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span class="w">                </span><span class="nt">&quot;type&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;STRING&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;value&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Zephyr&quot;</span>
<span class="w">            </span><span class="p">},</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;kind&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;multiResource&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;values&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nt">&quot;0&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="nt">&quot;1&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;5&quot;</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">                </span><span class="nt">&quot;kind&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;singleResource&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;id&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">17</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;type&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;STRING&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;value&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;qemu_x86&quot;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="p">],</span>
<span class="hll"><span class="w">            </span><span class="nt">&quot;id&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
</span><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="p">],</span>
<span class="w">        </span><span class="nt">&quot;kind&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;obj&quot;</span><span class="p">,</span>
<span class="hll"><span class="w">        </span><span class="nt">&quot;id&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">3</span>
</span><span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>The marked lines in the composite resource format show where Object ID,
Instance ID and Resource ID are located. A composite resource format can
consist of multiple Object IDs.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Currently multiResources are not supported and will be ignored. MultiResource
dataypes  are e.g. used for Voltage range (min, max).</p>
</div>
</section>
<section id="registration-updates">
<h3>Registration Updates<a class="headerlink" href="#registration-updates" title="Link to this heading">#</a></h3>
<p>Leshan maintains registrations of endpoints. An endpoint can be registered or
unregistered. To maintain its registration, an endpoint must send an update to
Leshan regularly. If an endpoint does not send an update within the specified
duration, it is considered offline and will be unregistered by Leshan.</p>
<p>Those registration events are encapsulated into an LwM2M Object and sent to the
backend server. The backend server stores the registration events in the
database. This allows to use the generic database model for the registration
events as well. All received registration events are stored in the database and
can be used for statistics.</p>
<p>All registration events are maintained in the custom LwM2M Object ID <code class="docutils literal notranslate"><span class="pre">10240</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">10240/0/0</span></code>: Endpoint <strong>registered</strong> to Leshan.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">10240/0/1</span></code>: Endpoint <strong>unregistered</strong> from Leshan.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">10240/0/2</span></code>: Endpoint <strong>updated</strong> its registration.</p></li>
</ul>
</section>
</section>
<section id="data-flow-backend-endpoint">
<span id="data-flow-backend-to-endpoint-label"></span><h2>Data Flow: Backend -&gt; Endpoint<a class="headerlink" href="#data-flow-backend-endpoint" title="Link to this heading">#</a></h2>
<p><a class="reference internal" href="django.html#term-Endpoint"><span class="xref std std-term">Endpoints</span></a> often operate in queue mode, meaning they are not
always online. The LwM2M Server is aware of the current status of a device
(Online/Offline) and communicates this status to the backend server. Leshan
does not queue pending data that should be sent to the device when it comes
online. The backend server must handle this by itself so it has to have a
representation of the current status of each device as well as the data to be
send. The resource table <code class="docutils literal notranslate"><span class="pre">EndpointOperation</span></code> is used to store pending
operations that should be sent to the endpoint while it is online.</p>
<p>Once an endpoint updates it’s registration (LwM2M Update Operation) Leshan
notifies the backend. The backend checks the <code class="docutils literal notranslate"><span class="pre">EndpointOperation</span></code> table for
pending operations and sends them to the device by posting to the Leshan hosted
ReST API. Leshan keeps the post call open until the device acknowledges the
operation or a timeout is generated. Endpoints can be slow to respond (several
Seconds), so the backend has to handle the ReST API call in an asynchronous
manner. By only sending data to endpoints while they are online, the backend
can be sure that the ReST API calls are not open for a long time.</p>
<section id="asynchronous-communication">
<h3>Asynchronous Communication<a class="headerlink" href="#asynchronous-communication" title="Link to this heading">#</a></h3>
<p>Given that endpoints are comparably slow to respond, handling communication
asynchronously is essential for efficient operation. This can be effectively
managed using Celery, a distributed task queue. When Leshan notifies the
backend of an endpoint status update, Celery can be used to handle the
long-running API calls, ensuring that the backend remains responsive and
scalable. As the backend communicates with many endpoints simultaneously, an
efficient queing mechanism is essential to ensure that the system remains
responsive and scalable.</p>
<p>Before the backend executes the API call, it updates the endpointOperation
status to <code class="docutils literal notranslate"><span class="pre">SENDING</span></code>, indicating an ongoing operation.</p>
<p>Once the API call is complete the database will be updated with the result
(e.g. <code class="docutils literal notranslate"><span class="pre">CONFIRMED</span></code>, <code class="docutils literal notranslate"><span class="pre">FAILED</span></code>, <code class="docutils literal notranslate"><span class="pre">QUEUED</span></code>) depending on the result of the
request. The <code class="docutils literal notranslate"><span class="pre">FAILED</span></code> status is assigned after 3 attempts. Retransmissions are
triggered when the endpoint updates it’s registration the next time.</p>
</section>
<section id="example-communication">
<h3>Example Communication<a class="headerlink" href="#example-communication" title="Link to this heading">#</a></h3>
<p>The following example shows how the backend server can send a firmware download
link resource <code class="docutils literal notranslate"><span class="pre">Package</span> <span class="pre">URI</span> <span class="pre">5/0/1</span></code> to an endpoint:</p>
<ol class="arabic simple">
<li><p>User creates new <code class="docutils literal notranslate"><span class="pre">EndpointOperation</span></code>: resource path <code class="docutils literal notranslate"><span class="pre">5/0/1</span></code>, value
<code class="docutils literal notranslate"><span class="pre">https://url.com/fw.bin</span></code>.</p></li>
<li><p>Backend checks endpoint online status.</p></li>
<li><p>If endpoint is offline, no further action is taken right away.</p></li>
<li><p>Endoint comes online, Leshan sends update to the backend.</p></li>
<li><p>Backend checks <code class="docutils literal notranslate"><span class="pre">EndpointOperation</span></code> table for pending operations for the
endpoint.</p></li>
<li><p>Finds pending operation, send resource to endpoint via the Leshan ReST API.</p></li>
<li><p>Pending operation is marked <code class="docutils literal notranslate"><span class="pre">completed</span></code> if the endpoint acknowledges the
operation.</p></li>
</ol>
</section>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="leshan.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Leshan</p>
      </div>
    </a>
    <a class="right-next"
       href="ota.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Over the Air Updates</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-flow-endpoint-backend">Data Flow: Endpoint -&gt; Backend</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#leshan-data-format">Leshan Data Format</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#registration-updates">Registration Updates</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-flow-backend-endpoint">Data Flow: Backend -&gt; Endpoint</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#asynchronous-communication">Asynchronous Communication</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-communication">Example Communication</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024, Individual contributors to flownexus.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>