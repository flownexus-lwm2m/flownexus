
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Simulation &#8212; flownexus  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=64d943e2" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'simulation';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Documentation" href="documentation.html" />
    <link rel="prev" title="Build and Deploy" href="deploy.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/flownexus_logo_dark.svg" class="logo__image only-light" alt="flownexus  documentation - Home"/>
    <script>document.write(`<img src="_static/flownexus_logo_light.svg" class="logo__image only-dark" alt="flownexus  documentation - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="architecture/index.html">Architecture</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="architecture/django.html">Django</a></li>
<li class="toctree-l2"><a class="reference internal" href="architecture/leshan.html">Leshan</a></li>
<li class="toctree-l2"><a class="reference internal" href="architecture/communication_interfaces.html">Communication, Interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="architecture/ota.html">Over the Air Updates</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="application_guide/index.html">Application Guide</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="application_guide/endpoint_interactions.html">Endpoint Interactions</a></li>
<li class="toctree-l2"><a class="reference internal" href="application_guide/events.html">Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="application_guide/queue_mode.html">Queue Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="application_guide/fw_setup.html">Firmware Setup</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="deploy.html">Build and Deploy</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="documentation.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">APIs</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="api_doc/api.html">Internal Django</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">News and Updates</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="news/weblog.html">Weblog</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/jonas-rem/flownexus" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/jonas-rem/flownexus/edit/main/doc/source/simulation.rst" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/jonas-rem/flownexus/issues/new?title=Issue%20on%20page%20%2Fsimulation.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Simulation</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#iot-devices-with-zephyr">IoT Devices with Zephyr</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#client-simulation">Client Simulation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prerequisites">Prerequisites</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simulating-a-single-endpoint">Simulating a single Endpoint</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simulation-script-simulate-py">Simulation Script (simulate.py)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simulating-multiple-endpoints">Simulating Multiple Endpoints</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#connecting-to-a-locally-hosted-leshan-server">Connecting to a locally hosted Leshan server</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configuring-the-firmware">Configuring the Firmware</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#attach-to-the-running-container">Attach to the running Container</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#manual-build-and-run">Manual build and run</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="simulation">
<h1>Simulation<a class="headerlink" href="#simulation" title="Link to this heading">#</a></h1>
<section id="iot-devices-with-zephyr">
<h2>IoT Devices with Zephyr<a class="headerlink" href="#iot-devices-with-zephyr" title="Link to this heading">#</a></h2>
<p>Zephyr implements an LwM2M client library <a class="footnote-reference brackets" href="#id5" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> and has an LwM2M client sample
<a class="footnote-reference brackets" href="#id6" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>. The Zephyr works with the flownexus server out of the box e.g. with an
nRF9160 DK board.</p>
<p>flownexus provides a modified sample at <code class="docutils literal notranslate"><span class="pre">simulation/lwm2m_client</span></code> to showcase
all server features.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The lwm2m_client sample is a copy of the original Zephyr sample. Distinct
features that showcase flownexus capabilities are planned for the upcoming
releases.</p>
</div>
</section>
<section id="client-simulation">
<h2>Client Simulation<a class="headerlink" href="#client-simulation" title="Link to this heading">#</a></h2>
<p>The lwm2m_client sample can run in simulation mode (<code class="docutils literal notranslate"><span class="pre">native_sim</span></code>) <a class="footnote-reference brackets" href="#id7" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>.
Building the sample with <code class="docutils literal notranslate"><span class="pre">native_sim</span></code> will generate a binary that can be
executed directly on the host machine. This allows to test all components
locally.</p>
<p>The native_sim simulation allows to connect the simulated Zephyr instance to
the host network <a class="footnote-reference brackets" href="#id8" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a>. Furthermore, simulated Zephyr endpoints have access to
the internet via the host network, allowing testing of both a locally hosted
instance of flownexus as well as a remote instance.</p>
<p>To simulate endpoints easily, a script is provided that builds and runs the
endpoints in a docker container. Setting up the network and running the
simulation in a docker container ensures interoperability with different host
systems.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The native_sim simulation does not have a true random number generator and
therefore the entropy source is limited. If a built simulation
image is run multiple times, the CoAP message that registers the endpoint with
the server may have the same message ID. The CoAP internal deduplicator will
ignore this message if a previous message within <code class="docutils literal notranslate"><span class="pre">NON_LIFETIME</span></code> seconds
(default 145 s) had the same message content and the same message ID. This
can lead to the device not being properly registered with the server.</p>
<p>This issue only shows if the same client registers multiple times within 145
s and only during simulation. Hardware with a true random number generator
is not affected, in face the CoAP deduplication feature is necessary for
reliable function. You can either wait for 145 s or rebuild the client. In
case of a rebuild the entropy seed will be different and the resulting
message ID will be different.</p>
</div>
<section id="prerequisites">
<h3>Prerequisites<a class="headerlink" href="#prerequisites" title="Link to this heading">#</a></h3>
<p>The simulation requires a working Docker installation.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~$ </span>apt<span class="w"> </span>install<span class="w"> </span>docker-ce
</pre></div>
</div>
</section>
<section id="simulating-a-single-endpoint">
<h3>Simulating a single Endpoint<a class="headerlink" href="#simulating-a-single-endpoint" title="Link to this heading">#</a></h3>
<p>The easiest way to run the simulation is to execute the simulate.py script
without any arguments:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~/workspace/flownexus/simulation$ </span>python3<span class="w"> </span>./simulate.py
<span class="go">No build/run options provided, build and run n clients with logging:</span>
<span class="go">  Warning: bindir will be cleaned, do you want to continue? [y/n]</span>
<span class="go">y</span>

<span class="go">Cleaning ./lwm2m_client/endpoint_binaries/, ./conf_tmp/</span>
<span class="go">Building Zephyr client [1/1]</span>
<span class="go">Building image from ./Dockerfile</span>
<span class="go">Starting container</span>
<span class="go">Starting zeth [1/1]</span>
<span class="go">Starting Zephyr client [1/1]</span>

<span class="go">*** Booting Zephyr OS build v3.7.0-rc3-75-gd06e95c49b75 ***</span>
<span class="go">[..]</span>
</pre></div>
</div>
<p>You should now be able see one active endoint with the registration name
<code class="docutils literal notranslate"><span class="pre">urn:imei:100000000000000</span></code> the registered node in the Django Admin dashboard
at <code class="docutils literal notranslate"><span class="pre">https://flownexus.org/admin/</span></code>.</p>
</section>
<section id="simulation-script-simulate-py">
<h3>Simulation Script (simulate.py)<a class="headerlink" href="#simulation-script-simulate-py" title="Link to this heading">#</a></h3>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">Options of the simulate.py script</span><a class="headerlink" href="#id9" title="Link to this code">#</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~/workspace/flownexus/simulation$ </span>python3<span class="w"> </span>simulate.py<span class="w"> </span>--help
<span class="go">usage: simulate.py [-h] [-n NUM_CLIENTS] [-v] [-b] [-r] [-d DELAY] [-l]</span>

<span class="go">Zephyr Build and Run Script</span>

<span class="go">options:</span>
<span class="go">  -h, --help      show this help message and exit</span>
<span class="go">  -n NUM_CLIENTS  Number of client instances to start. (1 - 254) (default: 1)</span>
<span class="go">  -v              Enable logging (default: False)</span>
<span class="go">  -b              Build the client (default: False)</span>
<span class="go">  -r              Run the client. (default: False)</span>
<span class="go">  -d DELAY        Client start delay [ms] (default: 0)</span>
<span class="go">  -l              Connect to locally running Leshan server (default: False)</span>
</pre></div>
</div>
</div>
</section>
<section id="simulating-multiple-endpoints">
<h3>Simulating Multiple Endpoints<a class="headerlink" href="#simulating-multiple-endpoints" title="Link to this heading">#</a></h3>
<p>The simulation allows to configure and start multiple Zephyr endpoints. The
script takes care of assigning individual IP addresses and gateway settings to
each endpoint. Furthermore it sets up the virtual network adapter (zeth) that
connects the endpoints to the host network. For that reason, each endpoint has
to be build before it can be started. The resulting binaries are stored in the
lwm2m_client sample (e.g. <code class="docutils literal notranslate"><span class="pre">lwm2m_client/endpoint_binaries/ep_0.exe</span></code>). A set
of devices can be build once and started by omitting the parameter <code class="docutils literal notranslate"><span class="pre">-b</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text">Build and run 10 endpoints without logging</span><a class="headerlink" href="#id10" title="Link to this code">#</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~/workspace/flownexus/simulation$ </span>python3<span class="w"> </span>simulate.py<span class="w"> </span>-b<span class="w"> </span>-r<span class="w"> </span>-n<span class="w"> </span><span class="m">10</span>
<span class="go">Cleaning ./lwm2m_client/endpoint_binaries/, ./conf_tmp/</span>
<span class="go">Building Zephyr client [10/10]</span>
<span class="go">Building image from ./Dockerfile</span>
<span class="go">Starting container</span>
<span class="go">Starting zeth [10/10]</span>
<span class="go">Starting Zephyr client [10/10]</span>
<span class="gp"># </span>Stop<span class="w"> </span>the<span class="w"> </span>simulation<span class="w"> </span>with<span class="w"> </span>&lt;Ctrl+c&gt;
<span class="go">Stopping container</span>
</pre></div>
</div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The simulate.py script supports max. 254 clients.</p>
</div>
</section>
<section id="connecting-to-a-locally-hosted-leshan-server">
<h3>Connecting to a locally hosted Leshan server<a class="headerlink" href="#connecting-to-a-locally-hosted-leshan-server" title="Link to this heading">#</a></h3>
<p>Connecting to a locally hosted Leshan server is possible by setting the <code class="docutils literal notranslate"><span class="pre">-l</span></code>
flag. The script will connect the simulated Zephyr instances to the Leshan
server running on the host machine. Internally, the script overwrites the
<code class="docutils literal notranslate"><span class="pre">LWM2M_APP_SERVER</span></code> configuration option in the Zephyr lwm2m_client sample
with the IP address of the container with the running Leshan server.</p>
<p>If the Leshan server is started on the host natively (without docker compose),
change the IP address in the Kconfig file (see next chapter) to
<code class="docutils literal notranslate"><span class="pre">coap://192.0.2.2:5683</span></code>.</p>
</section>
<section id="configuring-the-firmware">
<h3>Configuring the Firmware<a class="headerlink" href="#configuring-the-firmware" title="Link to this heading">#</a></h3>
<p>You can change the flownexus domain that you want to connect to by modifying
the <code class="docutils literal notranslate"><span class="pre">Kconfig</span></code> file in the lwm2m_client sample.</p>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text">Change LwM2M server to the public hosted eclipse leshan server</span><a class="headerlink" href="#id11" title="Link to this code">#</a></div>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="w"> </span>./simulation/lwm2m_client/Kconfig
<span class="w"> </span>config LWM2M_APP_SERVER
<span class="w"> </span>       string &quot;LwM2M server address&quot;
<span class="gd">-       default &quot;coap://flownexus.org:5683&quot; if !LWM2M_DTLS_SUPPORT</span>
<span class="gi">+       default &quot;coap://leshan.eclipseprojects.io:5683&quot; if !LWM2M_DTLS_SUPPORT</span>
</pre></div>
</div>
</div>
<dl class="simple">
<dt>Leshan URLs:</dt><dd><ul class="simple">
<li><p>flownexus public server: <code class="docutils literal notranslate"><span class="pre">coap://flownexus.org:5683</span></code></p></li>
<li><p>Eclipse public Leshan server: <code class="docutils literal notranslate"><span class="pre">coap://leshan.eclipseprojects.io:5683</span></code></p></li>
</ul>
</dd>
</dl>
<p>If you want to modify the firmware further, check <a class="reference internal" href="application_guide/fw_setup.html#firmware-setup"><span class="std std-ref">Firmware Setup</span></a> for
more details on this topic.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>After making changes to Kconfig, make sure to delete the build directory
to ensure that the changes are applied.</p>
</div>
</section>
<section id="attach-to-the-running-container">
<h3>Attach to the running Container<a class="headerlink" href="#attach-to-the-running-container" title="Link to this heading">#</a></h3>
<p>After starting the simulation, you can attach to the running container e.g. to
attach to the Shell terminal of a running Zephyr instance:</p>
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text">Attach to the running container</span><a class="headerlink" href="#id12" title="Link to this code">#</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~/workspace/flownexus/simulation$ </span>python3<span class="w"> </span>simulate.py<span class="w"> </span>-b<span class="w"> </span>-r<span class="w"> </span>-n<span class="w"> </span><span class="m">1</span>
<span class="go">Cleaning ./lwm2m_client/endpoint_binaries/, ./conf_tmp/</span>
<span class="go">Building Zephyr client [1/1]</span>
<span class="go">Building image from ./Dockerfile</span>
<span class="go">Starting container</span>
<span class="go">Starting zeth [1/1]</span>
<span class="go">Starting Zephyr client [1/1]</span>
<span class="go">Quit &lt;q&gt;;   Attach to Container &lt;a&gt;</span>
<span class="go">a</span>

<span class="gp">root@855c499d5a09:/home/workspace/flownexus/simulation# </span>tio<span class="w"> </span>/dev/pts/0
<span class="go">tio v2.7</span>
<span class="go">Press ctrl-t q to quit</span>
<span class="go">Connected</span>
<span class="gp gp-VirtualEnv">(Press &lt;Tab&gt; to interact with the Zephyr Shell)</span>

<span class="go">  clear    device   devmem   help     history  kernel   lwm2m    net</span>
<span class="go">  rem      resize   retval   shell</span>
</pre></div>
</div>
</div>
<p>By having access to individual nodes, you can interact with the Zephyr Shell
and test different features. In particular, interacting with the LwM2M Shell
can be useful to test the LwM2M client features.</p>
</section>
<section id="manual-build-and-run">
<h3>Manual build and run<a class="headerlink" href="#manual-build-and-run" title="Link to this heading">#</a></h3>
<p>For development purposes, it can be useful to build and run the simulation
manually. The following steps show how to setup zeth network, build and run the
Zephyr lwm2m_client sample.</p>
<div class="literal-block-wrapper docutils container" id="id13">
<div class="code-block-caption"><span class="caption-text">Manual build and run of the Zephyr lwm2m_client sample</span><a class="headerlink" href="#id13" title="Link to this code">#</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">host:~/workspace/flownexus$ </span>west<span class="w"> </span>update<span class="w"> </span><span class="c1"># Update the Zephyr repository</span>
<span class="gp">host:~/workspace/flownexus$ </span>../tools/net-tools/net-setup.sh<span class="w"> </span>start
<span class="go">Using ../tools/net-tools/./zeth.conf configuration file.</span>
<span class="go">Creating zeth</span>
<span class="gp">host:~/workspace/flownexus$ </span>west<span class="w"> </span>build<span class="w"> </span>-b<span class="w"> </span>native_sim<span class="w"> </span>simulation/lwm2m_client<span class="w"> </span>-p<span class="w"> </span>--<span class="w"> </span>-DCONF<span class="o">=</span>overlay-lwm2m-1.1.conf
<span class="gp">host:~/workspace/flownexus$ </span>west<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>run
<span class="go">*** Booting Zephyr OS build v3.7.0-rc3-75-gd06e95c49b75 ***</span>
<span class="go">[..]</span>
<span class="go">&lt;inf&gt; net_config: IPv4 address: 192.0.2.1</span>
<span class="go">&lt;inf&gt; net_lwm2m_client_app: Run LWM2M client</span>

<span class="gp"># </span>Stop<span class="w"> </span>the<span class="w"> </span>simulation<span class="w"> </span>with<span class="w"> </span>&lt;Ctrl+c&gt;,<span class="w"> </span><span class="k">do</span><span class="w"> </span>not<span class="w"> </span>forget<span class="w"> </span>to<span class="w"> </span>stop<span class="w"> </span>the<span class="w"> </span>zeth<span class="w"> </span>network
<span class="gp">host:~/workspace/flownexus$ </span>../tools/net-tools/net-setup.sh<span class="w"> </span>stop
<span class="go">Using ../tools/net-tools/./zeth.conf configuration file.</span>
<span class="go">Removing zeth</span>
</pre></div>
</div>
</div>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id5" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://docs.zephyrproject.org/latest/connectivity/networking/api/lwm2m.html">https://docs.zephyrproject.org/latest/connectivity/networking/api/lwm2m.html</a></p>
</aside>
<aside class="footnote brackets" id="id6" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://docs.zephyrproject.org/latest/samples/net/lwm2m_client/README.html">https://docs.zephyrproject.org/latest/samples/net/lwm2m_client/README.html</a></p>
</aside>
<aside class="footnote brackets" id="id7" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">3</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://docs.zephyrproject.org/latest/boards/native/native_sim/doc/index.html">https://docs.zephyrproject.org/latest/boards/native/native_sim/doc/index.html</a>.</p>
</aside>
<aside class="footnote brackets" id="id8" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">4</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://docs.zephyrproject.org/latest/connectivity/networking/networking_with_multiple_instances.html">https://docs.zephyrproject.org/latest/connectivity/networking/networking_with_multiple_instances.html</a></p>
</aside>
</aside>
</section>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="deploy.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Build and Deploy</p>
      </div>
    </a>
    <a class="right-next"
       href="documentation.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Documentation</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#iot-devices-with-zephyr">IoT Devices with Zephyr</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#client-simulation">Client Simulation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prerequisites">Prerequisites</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simulating-a-single-endpoint">Simulating a single Endpoint</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simulation-script-simulate-py">Simulation Script (simulate.py)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simulating-multiple-endpoints">Simulating Multiple Endpoints</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#connecting-to-a-locally-hosted-leshan-server">Connecting to a locally hosted Leshan server</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configuring-the-firmware">Configuring the Firmware</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#attach-to-the-running-container">Attach to the running Container</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#manual-build-and-run">Manual build and run</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      Â© Copyright 2024, Individual contributors to flownexus.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>