
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Over the Air Updates &#8212; flownexus  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=64d943e2" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'architecture/ota';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Application Guide" href="../application_guide/index.html" />
    <link rel="prev" title="Communication, Interfaces" href="communication_interfaces.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/flownexus_logo_light.svg" class="logo__image only-light" alt="flownexus  documentation - Home"/>
    <script>document.write(`<img src="../_static/flownexus_logo_light.svg" class="logo__image only-dark" alt="flownexus  documentation - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Architecture</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="django.html">Django</a></li>
<li class="toctree-l2"><a class="reference internal" href="leshan.html">Leshan</a></li>
<li class="toctree-l2"><a class="reference internal" href="communication_interfaces.html">Communication, Interfaces</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Over the Air Updates</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../application_guide/index.html">Application Guide</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../application_guide/endpoint_interactions.html">Endpoint Interactions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../application_guide/events.html">Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="../application_guide/queue_mode.html">Queue Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../application_guide/fw_setup.html">Firmware Setup</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../deploy.html">Build and Deploy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../simulation.html">Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../documentation.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">APIs</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../api_doc/api.html">Internal Django</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">News and Updates</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../news/weblog.html">Weblog</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/jonas-rem/flownexus" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/jonas-rem/flownexus/edit/main/doc/source/architecture/ota.rst" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/jonas-rem/flownexus/issues/new?title=Issue%20on%20page%20%2Farchitecture/ota.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Over the Air Updates</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#update-process-of-a-firmware">Update process of a Firmware</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#states-of-a-ota-update">States of a OTA Update</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#result-codes-for-an-ota-update">Result Codes for an OTA Update</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="over-the-air-updates">
<h1>Over the Air Updates<a class="headerlink" href="#over-the-air-updates" title="Link to this heading">#</a></h1>
<p>Over the Air (OTA) updates are a way to update the firmware of a device
remotely. This is a mandatory feature for any IoT device. The device must be
able to update its firmware without any physical user intervention.</p>
<p>flownexus implements OTA updates according to the LwM2M protocol. The LwM2M
protocol specifies how to update the firmware of a device. The OTA process is
implemented by sending a link to a firmware via LwM2M object 5/0/1 - Package
URI. This method is called Pull via HTTP(s) and is faster, compared to a
transfer via CoAP. Updates via CoAP blockwise transfer to download the firmware
are not supported.</p>
<p>More information about a possible firmware implementation can be found in the
<code class="docutils literal notranslate"><span class="pre">lwm2m_client</span></code> firmware sample at
<code class="docutils literal notranslate"><span class="pre">flownexus/simulation/lwm2m_client/src/firmware_update.c</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Firmware Updates are implemented in the LwM2M server and the example
firmware. A set up a PKI with self-signed certificates is required for the
server to communicate with the device via https. This setup will be
described in upcoming releases shortly.</p>
</div>
<section id="update-process-of-a-firmware">
<h2>Update process of a Firmware<a class="headerlink" href="#update-process-of-a-firmware" title="Link to this heading">#</a></h2>
<p>The update process is described in detail in the <a class="reference external" href="https://www.openmobilealliance.org/release/LightweightM2M/V1_1_1-20190617-A/OMA-TS-LightweightM2M_Core-V1_1_1-20190617-A.pdf">LwM2M core specification
v1.1.1</a> Chapter <em>E.6 LwM2M Object: Firmware Update</em>. This chapter summarizes
the update process:</p>
<ol class="arabic simple">
<li><p>flownexus sends a link to the firmware to the device via LwM2M object 5/0/1
- Package URI. It is a relative link to the firmware on the server, e.g.
<code class="docutils literal notranslate"><span class="pre">/media/firmware/v0.1.0.bin</span></code>. The host <code class="docutils literal notranslate"><span class="pre">https://flownexus.org</span></code> is
fixed in firmware.</p></li>
<li><p>The device downloads the firmware from the server via http(s) and sets the
state to <code class="docutils literal notranslate"><span class="pre">STATE_DOWNLOADING</span></code>.</p></li>
<li><p>The device sets the state to <code class="docutils literal notranslate"><span class="pre">STATE_DOWNLOADED</span></code> after the download is
complete.</p></li>
<li><p>flownexus executes the command 5/0/2 - Update to the device.</p></li>
<li><p>The device sets the state to <code class="docutils literal notranslate"><span class="pre">STATE_UPDATING</span></code> upon receiving the command.</p></li>
<li><p>The device updates the firmware and communicates the result to flownexus.</p></li>
</ol>
<p>This process ensures that errors during the update process are handled and
communicated to the backend.</p>
<section id="states-of-a-ota-update">
<h3>States of a OTA Update<a class="headerlink" href="#states-of-a-ota-update" title="Link to this heading">#</a></h3>
<p>There are 4 device states during an OTA update. flownexus tracks the state of
the device during the update process in the database (FirmwareUpdate table).
Once the update is completed (failed or successful), the state is set always
set to <code class="docutils literal notranslate"><span class="pre">STATE_IDLE</span></code>.</p>
<div class="pst-scrollable-table-container"><table class="table" id="id1">
<caption><span class="caption-text">Device States during an OTA Update</span><a class="headerlink" href="#id1" title="Link to this table">#</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>State</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>STATE_IDLE</p></td>
<td><p>device is idle</p></td>
</tr>
<tr class="row-odd"><td><p>STATE_DOWNLOADING</p></td>
<td><p>device is downloading</p></td>
</tr>
<tr class="row-even"><td><p>STATE_DOWNLOADED</p></td>
<td><p>download is complete</p></td>
</tr>
<tr class="row-odd"><td><p>STATE_UPDATING</p></td>
<td><p>device is updating</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="result-codes-for-an-ota-update">
<h3>Result Codes for an OTA Update<a class="headerlink" href="#result-codes-for-an-ota-update" title="Link to this heading">#</a></h3>
<p>For every OTA update, a result is generated after the update failed or
successful. There can be only one active OTA update at a time for each client.
An active OTA is indicated by the result <code class="docutils literal notranslate"><span class="pre">RESULT_DEFAULT</span></code>. The result for
each OTA update is stored in the database (FirmwareUpdate table).</p>
<div class="pst-scrollable-table-container"><table class="table" id="id2">
<caption><span class="caption-text">Result Codes for an OTA Update</span><a class="headerlink" href="#id2" title="Link to this table">#</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Result</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>RESULT_DEFAULT</p></td>
<td><p>default state</p></td>
</tr>
<tr class="row-odd"><td><p>RESULT_SUCCESS</p></td>
<td><p>update was successful</p></td>
</tr>
<tr class="row-even"><td><p>RESULT_NO_STORAGE</p></td>
<td><p>no storage available</p></td>
</tr>
<tr class="row-odd"><td><p>RESULT_OUT_OF_MEM</p></td>
<td><p>out of memory</p></td>
</tr>
<tr class="row-even"><td><p>RESULT_CONNECTION_LOST</p></td>
<td><p>connection was lost</p></td>
</tr>
<tr class="row-odd"><td><p>RESULT_INTEGRITY_FAILED</p></td>
<td><p>integrity check failed</p></td>
</tr>
<tr class="row-even"><td><p>RESULT_UNSUP_FW</p></td>
<td><p>unsupported firmware</p></td>
</tr>
<tr class="row-odd"><td><p>RESULT_INVALID_URI</p></td>
<td><p>invalid uri provided</p></td>
</tr>
<tr class="row-even"><td><p>RESULT_UPDATE_FAILED</p></td>
<td><p>update failed</p></td>
</tr>
<tr class="row-odd"><td><p>RESULT_UNSUP_PROTO</p></td>
<td><p>unsupported protocol</p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="communication_interfaces.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Communication, Interfaces</p>
      </div>
    </a>
    <a class="right-next"
       href="../application_guide/index.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Application Guide</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#update-process-of-a-firmware">Update process of a Firmware</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#states-of-a-ota-update">States of a OTA Update</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#result-codes-for-an-ota-update">Result Codes for an OTA Update</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024, Individual contributors to flownexus.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>